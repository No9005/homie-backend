name: homie_core
services:

  homie_core:
    build:
      context: .
    image: homie_core
    container_name: homie_core
    restart: unless-stopped
    volumes:
      - .:/web/app
      - ./database:/web/app/database
    environment:
      DJANGO_SETTINGS_MODULE: src.homie.settings
      VIRTUAL_HOST: api.homie-dev.com
      DJANGO_SECRET_KEY: ${DJANGO_SECRET_KEY:-"CHOOSE_OTHER_KEY_FOR_PRODUCTION"}
      DEBUG: ${DEBUG:-True}
      ALLOWED_HOSTS: ${ALLOWED_HOSTS:-api.homie-dev.com}
      ENABLE_DJANGO_DEBUG_TOOLBAR: ${ENABLE_DJANGO_DEBUG_TOOLBAR:-False}

  nginx-proxy:
    image: jwilder/nginx-proxy:1.2.3-alpine
    container_name: homie_proxy
    restart: unless-stopped
    ports:
      - "${JWILDER_PROXY_PORT:-80}:80"
      - "4431:443"
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - ./nginx-proxy/global.conf:/etc/nginx/conf.d/global_proxy.conf
      - ./nginx-proxy/certs:/etc/nginx/certs
    environment:
      HTTPS_METHOD: noredirect
      TZ: Europe/Berlin
  

networks:
  default:
    name: homie
    external: false